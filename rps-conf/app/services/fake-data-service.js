"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var static_data_1 = require("../shared/static-data");
var fileSystemModule = require("file-system");
var faker = require("faker");
var NUM_SPEAKERS = 40;
var NUM_ROOM_INFOS = 10;
var SESSION_LENGTH = 60;
function generateSpeakers() {
    var speakerList = [];
    var avatarsMen = getSpeakerAvatars('images/speakers/base64/men.txt');
    var avatarsWomen = getSpeakerAvatars('images/speakers/base64/women.txt');
    for (var i = 0; i <= NUM_SPEAKERS; i++) {
        var genderBool = faker.random.boolean();
        var genderInt = parseInt(genderBool + '');
        var firstName = faker.name.firstName(genderInt);
        var lastName = faker.name.lastName(genderInt);
        var picture = genderBool ? avatarsMen[faker.random.number(avatarsMen.length - 1)] : avatarsWomen[faker.random.number(avatarsWomen.length - 1)];
        var s = {
            id: faker.random.uuid(),
            name: firstName + ' ' + lastName,
            title: faker.name.jobTitle(),
            company: faker.company.companyName(),
            picture: picture,
            twitterName: '@' + faker.internet.userName(firstName, lastName)
        };
        speakerList.push(s);
    }
    return speakerList;
}
exports.generateSpeakers = generateSpeakers;
function generateRoomInfos() {
    var roomInfoList = [];
    for (var i = 0; i <= NUM_ROOM_INFOS; i++) {
        var r = {
            roomId: faker.random.uuid(),
            name: faker.address.streetName() + ' ' + faker.random.number(10),
            url: faker.internet.domainName(),
            theme: faker.lorem.words(1)
        };
        roomInfoList.push(r);
    }
    return roomInfoList;
}
exports.generateRoomInfos = generateRoomInfos;
function generateSessions(speakers, roomInfos) {
    var sessionList = [];
    var idSeed = 1000;
    for (var _i = 0, conferenceDays_1 = static_data_1.conferenceDays; _i < conferenceDays_1.length; _i++) {
        var confDay = conferenceDays_1[_i];
        var timeSlots = generateTimeSlots(confDay);
        for (var _a = 0, timeSlots_1 = timeSlots; _a < timeSlots_1.length; _a++) {
            var confTimeSlot = timeSlots_1[_a];
            if (confTimeSlot.isBreak) {
                //break session
                var s = {
                    id: (idSeed++).toString(),
                    title: toTitleCase(confTimeSlot.title),
                    isBreak: true,
                    start: confTimeSlot.start.toString(),
                    end: confTimeSlot.end.toString(),
                    room: '',
                    roomInfo: null,
                    speakers: [],
                    description: '',
                    descriptionShort: '',
                    calendarEventId: ''
                };
                sessionList.push(s);
            }
            else {
                //speaker session
                var subSpeakers = getRandomArrayElements(speakers, faker.random.number(3));
                var roomInfo = roomInfos[faker.random.number(roomInfos.length - 1)];
                var s = {
                    id: (idSeed++).toString(),
                    title: toTitleCase(faker.company.bs()),
                    isBreak: false,
                    start: confTimeSlot.start.toString(),
                    end: confTimeSlot.end.toString(),
                    room: roomInfo.name,
                    roomInfo: roomInfo,
                    speakers: subSpeakers,
                    description: faker.lorem.paragraph(),
                    descriptionShort: faker.lorem.sentence(),
                    calendarEventId: faker.random.uuid()
                };
                sessionList.push(s);
            }
        }
    }
    return sessionList;
}
exports.generateSessions = generateSessions;
function generateTimeSlots(confDay) {
    var timeSlotList = [];
    var startTimeList = getTimeRange(addMinutes(confDay.date, 240), addMinutes(confDay.date, 780), SESSION_LENGTH);
    for (var _i = 0, startTimeList_1 = startTimeList; _i < startTimeList_1.length; _i++) {
        var startTime = startTimeList_1[_i];
        var isBreak = false;
        var sessionTitle = '';
        if (startTime.getHours() == 4) {
            isBreak = true;
            sessionTitle = 'Welcome Message';
        }
        else if (startTime.getHours() == 8) {
            isBreak = true;
            sessionTitle = 'Lunch Break';
        }
        var cTimeSlot = { title: sessionTitle, isBreak: isBreak, start: startTime, end: addMinutes(startTime, SESSION_LENGTH) };
        timeSlotList.push(cTimeSlot);
    }
    return timeSlotList;
}
function getTimeRange(startTime, endTime, minutesBetween) {
    var startTimeList = [];
    var diffInMinutes = Math.round((endTime.getTime() - startTime.getTime()) / 60000);
    var periods = diffInMinutes / minutesBetween;
    for (var i = 0; i <= periods; i++) {
        var periodStart = addMinutes(startTime, (minutesBetween * i));
        startTimeList.push(periodStart);
    }
    return startTimeList;
}
function addMinutes(date, minutes) {
    return new Date(date.getTime() + minutes * 60000);
}
function toTitleCase(str) {
    return str.replace(/\w\S*/g, function (txt) { return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase(); });
}
function getRandomArrayElements(arr, count) {
    var shuffled = arr.slice(0), i = arr.length, min = i - count, temp, index;
    while (i-- > min) {
        index = Math.floor((i + 1) * Math.random());
        temp = shuffled[index];
        shuffled[index] = shuffled[i];
        shuffled[i] = temp;
    }
    return shuffled.slice(min);
}
function getSpeakerAvatars(path) {
    var avatarList = [];
    var currentAppFolder = fileSystemModule.knownFolders.currentApp();
    var file = currentAppFolder.getFile(path);
    var fileText = file.readTextSync();
    var lines = fileText.split('\n');
    for (var i = 0; i < lines.length; i++) {
        avatarList.push('data:image/png;base64,' + lines[i]);
    }
    return avatarList;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmFrZS1kYXRhLXNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJmYWtlLWRhdGEtc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUNBLHFEQUF1RDtBQUN2RCw4Q0FBZ0Q7QUFFaEQsNkJBQWdDO0FBRWhDLElBQUksWUFBWSxHQUFHLEVBQUUsQ0FBQztBQUN0QixJQUFJLGNBQWMsR0FBRyxFQUFFLENBQUM7QUFDeEIsSUFBSSxjQUFjLEdBQUcsRUFBRSxDQUFDO0FBRXhCO0lBQ0ksSUFBSSxXQUFXLEdBQW1CLEVBQUUsQ0FBQztJQUNyQyxJQUFJLFVBQVUsR0FBRyxpQkFBaUIsQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFDO0lBQ3JFLElBQUksWUFBWSxHQUFHLGlCQUFpQixDQUFDLGtDQUFrQyxDQUFDLENBQUM7SUFDekUsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsSUFBSSxZQUFZLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztRQUNyQyxJQUFJLFVBQVUsR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ3hDLElBQUksU0FBUyxHQUFJLFFBQVEsQ0FBQyxVQUFVLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDM0MsSUFBSSxTQUFTLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDaEQsSUFBSSxRQUFRLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDOUMsSUFBSSxPQUFPLEdBQUcsVUFBVSxHQUFHLFVBQVUsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsTUFBTSxHQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsWUFBWSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxNQUFNLEdBQUMsQ0FBQyxDQUFDLENB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dkIsUUFBUSxDQUFDLEtBQUssQ0FBQyxHQUFHLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM5QixRQUFRLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDO0lBQ3ZCLENBQUM7SUFDRCxNQUFNLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUMvQixDQUFDO0FBRUQsMkJBQTJCLElBQUk7SUFDM0IsSUFBSSxVQUFVLEdBQWtCLEVBQUUsQ0FBQztJQUNuQyxJQUFJLGdCQUFnQixHQUFHLGdCQUFnQixDQUFDLFlBQVksQ0FBQyxVQUFVLEVBQUUsQ0FBQztJQUNsRSxJQUFJLElBQUksR0FBRyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDMUMsSUFBSSxRQUFRLEdBQUcsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO0lBRW5DLElBQUksS0FBSyxHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDakMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7UUFDcEMsVUFBVSxDQUFDLElBQUksQ0FBQyx3QkFBd0IsR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN6RCxDQUFDO0lBQ0QsTUFBTSxDQUFDLFVBQVUsQ0FBQztBQUN0QixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU2Vzc2lvbiwgU3BlYWtlciwgUm9vbUluZm8sIENvbmZlcmVuY2VEYXksIENvbmZUaW1lU2xvdCB9IGZyb20gJy4uL3NoYXJlZC9pbnRlcmZhY2VzJztcclxuaW1wb3J0IHsgY29uZmVyZW5jZURheXMgfSBmcm9tICcuLi9zaGFyZWQvc3RhdGljLWRhdGEnO1xyXG5pbXBvcnQgKiBhcyBmaWxlU3lzdGVtTW9kdWxlIGZyb20gJ2ZpbGUtc3lzdGVtJztcclxuXHJcbmltcG9ydCBmYWtlciA9IHJlcXVpcmUoJ2Zha2VyJyk7XHJcblxyXG5sZXQgTlVNX1NQRUFLRVJTID0gNDA7XHJcbmxldCBOVU1fUk9PTV9JTkZPUyA9IDEwO1xyXG5sZXQgU0VTU0lPTl9MRU5HVEggPSA2MDtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZVNwZWFrZXJzKCkgOiBBcnJheTxTcGVha2VyPiB7XHJcbiAgICB2YXIgc3BlYWtlckxpc3Q6IEFycmF5PFNwZWFrZXI+ID0gW107XHJcbiAgICB2YXIgYXZhdGFyc01lbiA9IGdldFNwZWFrZXJBdmF0YXJzKCdpbWFnZXMvc3BlYWtlcnMvYmFzZTY0L21lbi50eHQnKTtcclxuICAgIHZhciBhdmF0YXJzV29tZW4gPSBnZXRTcGVha2VyQXZhdGFycygnaW1hZ2VzL3NwZWFrZXJzL2Jhc2U2NC93b21lbi50eHQnKTtcclxuICAgIGZvciAodmFyIGkgPSAwOyBpIDw9IE5VTV9TUEVBS0VSUzsgaSsrKSB7XHJcbiAgICAgICAgdmFyIGdlbmRlckJvb2wgPSBmYWtlci5yYW5kb20uYm9vbGVhbigpO1xyXG4gICAgICAgIHZhciBnZW5kZXJJbnQgPSAgcGFyc2VJbnQoZ2VuZGVyQm9vbCArICcnKTtcclxuICAgICAgICB2YXIgZmlyc3ROYW1lID0gZmFrZXIubmFtZS5maXJzdE5hbWUoZ2VuZGVySW50KTtcclxuICAgICAgICB2YXIgbGFzdE5hbWUgPSBmYWtlci5uYW1lLmxhc3ROYW1lKGdlbmRlckludCk7XHJcbiAgICAgICAgdmFyIHBpY3R1cmUgPSBnZW5kZXJCb29sID8gYXZhdGFyc01lbltmYWtlci5yYW5kb20ubnVtYmVyKGF2YXRhcnNNZW4ubGVuZ3RoLTEpXSA6IGF2YXRhcnNXb21lbltmYWtlci5yYW5kb20ubnVtYmVyKGF2YXRhcnNXb21lbi5sZW5ndGgtMSldO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGxldCBzOiBTcGVha2VyID0ge1xyXG4gICAgICAgICAgICBpZDogZmFrZXIucmFuZG9tLnV1aWQoKSxcclxuICAgICAgICAgICAgbmFtZTogZmlyc3ROYW1lICsgJyAnICsgbGFzdE5hbWUsXHJcbiAgICAgICAgICAgIHRpdGxlOiBmYWtlci5uYW1lLmpvYlRpdGxlKCksXHJcbiAgICAgICAgICAgIGNvbXBhbnk6IGZha2VyLmNvbXBhbnkuY29tcGFueU5hbWUoKSxcclxuICAgICAgICAgICAgcGljdHVyZTogcGljdHVyZSxcclxuICAgICAgICAgICAgdHdpdHRlck5hbWU6ICdAJyArIGZha2VyLmludGVybmV0LnVzZXJOYW1lKGZpcnN0TmFtZSwgbGFzdE5hbWUpXHJcbiAgICAgICAgfTtcclxuICAgICAgICBcclxuICAgICAgICBzcGVha2VyTGlzdC5wdXNoKHMpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBzcGVha2VyTGlzdDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdlbmVyYXRlUm9vbUluZm9zKCkgOiBBcnJheTxSb29tSW5mbz4ge1xyXG4gICAgdmFyIHJvb21JbmZvTGlzdDogQXJyYXk8Um9vbUluZm8+ID0gW107XHJcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8PSBOVU1fUk9PTV9JTkZPUzsgaSsrKSB7XHJcbiAgICAgICAgbGV0IHI6IFJvb21JbmZvID0ge1xyXG4gICAgICAgICAgICByb29tSWQ6IGZha2VyLnJhbmRvbS51dWlkKCksXHJcbiAgICAgICAgICAgIG5hbWU6IGZha2VyLmFkZHJlc3Muc3RyZWV0TmFtZSgpICsgJyAnICsgZmFrZXIucmFuZG9tLm51bWJlcigxMCksXHJcbiAgICAgICAgICAgIHVybDogZmFrZXIuaW50ZXJuZXQuZG9tYWluTmFtZSgpLFxyXG4gICAgICAgICAgICB0aGVtZTogZmFrZXIubG9yZW0ud29yZHMoMSlcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJvb21JbmZvTGlzdC5wdXNoKHIpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJvb21JbmZvTGlzdDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdlbmVyYXRlU2Vzc2lvbnMoc3BlYWtlcnM6IEFycmF5PFNwZWFrZXI+LCByb29tSW5mb3M6IEFycmF5PFJvb21JbmZvPikgOiBBcnJheTxTZXNzaW9uPiB7XHJcbiAgICB2YXIgc2Vzc2lvbkxpc3Q6IEFycmF5PFNlc3Npb24+ID0gW107XHJcbiAgICB2YXIgaWRTZWVkID0gMTAwMDtcclxuICAgIGZvciAodmFyIGNvbmZEYXkgb2YgY29uZmVyZW5jZURheXMpIHtcclxuICAgICAgICB2YXIgdGltZVNsb3RzID0gZ2VuZXJhdGVUaW1lU2xvdHMoY29uZkRheSk7XHJcbiAgICAgICAgZm9yICh2YXIgY29uZlRpbWVTbG90IG9mIHRpbWVTbG90cykge1xyXG4gICAgICAgICAgICBpZiAoY29uZlRpbWVTbG90LmlzQnJlYWspIHtcclxuICAgICAgICAgICAgICAgIC8vYnJlYWsgc2Vzc2lvblxyXG4gICAgICAgICAgICAgICAgbGV0IHM6IFNlc3Npb24gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWQ6IChpZFNlZWQrKykudG9TdHJpbmcoKSxcclxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogdG9UaXRsZUNhc2UoY29uZlRpbWVTbG90LnRpdGxlKSxcclxuICAgICAgICAgICAgICAgICAgICBpc0JyZWFrOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBjb25mVGltZVNsb3Quc3RhcnQudG9TdHJpbmcoKSxcclxuICAgICAgICAgICAgICAgICAgICBlbmQ6IGNvbmZUaW1lU2xvdC5lbmQudG9TdHJpbmcoKSxcclxuICAgICAgICAgICAgICAgICAgICByb29tOiAnJyxcclxuICAgICAgICAgICAgICAgICAgICByb29tSW5mbzogbnVsbCxcclxuICAgICAgICAgICAgICAgICAgICBzcGVha2VyczogW10sXHJcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICcnLFxyXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uU2hvcnQ6ICcnLFxyXG4gICAgICAgICAgICAgICAgICAgIGNhbGVuZGFyRXZlbnRJZDogJydcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICBzZXNzaW9uTGlzdC5wdXNoKHMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy9zcGVha2VyIHNlc3Npb25cclxuICAgICAgICAgICAgICAgIHZhciBzdWJTcGVha2VycyA9IGdldFJhbmRvbUFycmF5RWxlbWVudHMoc3BlYWtlcnMsIGZha2VyLnJhbmRvbS5udW1iZXIoMykpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHJvb21JbmZvID0gcm9vbUluZm9zW2Zha2VyLnJhbmRvbS5udW1iZXIocm9vbUluZm9zLmxlbmd0aC0xKV07XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGxldCBzOiBTZXNzaW9uID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlkOiAoaWRTZWVkKyspLnRvU3RyaW5nKCksXHJcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHRvVGl0bGVDYXNlKGZha2VyLmNvbXBhbnkuYnMoKSksXHJcbiAgICAgICAgICAgICAgICAgICAgaXNCcmVhazogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgc3RhcnQ6IGNvbmZUaW1lU2xvdC5zdGFydC50b1N0cmluZygpLFxyXG4gICAgICAgICAgICAgICAgICAgIGVuZDogY29uZlRpbWVTbG90LmVuZC50b1N0cmluZygpLFxyXG4gICAgICAgICAgICAgICAgICAgIHJvb206IHJvb21JbmZvLm5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgcm9vbUluZm86IHJvb21JbmZvLFxyXG4gICAgICAgICAgICAgICAgICAgIHNwZWFrZXJzOiBzdWJTcGVha2VycyxcclxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogZmFrZXIubG9yZW0ucGFyYWdyYXBoKCksXHJcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb25TaG9ydDogZmFrZXIubG9yZW0uc2VudGVuY2UoKSxcclxuICAgICAgICAgICAgICAgICAgICBjYWxlbmRhckV2ZW50SWQ6IGZha2VyLnJhbmRvbS51dWlkKClcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICBzZXNzaW9uTGlzdC5wdXNoKHMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHNlc3Npb25MaXN0O1xyXG59XHJcblxyXG5mdW5jdGlvbiBnZW5lcmF0ZVRpbWVTbG90cyhjb25mRGF5OiBDb25mZXJlbmNlRGF5KSA6IEFycmF5PENvbmZUaW1lU2xvdD4ge1xyXG4gICAgdmFyIHRpbWVTbG90TGlzdDogQXJyYXk8Q29uZlRpbWVTbG90PiA9IFtdO1xyXG4gICAgdmFyIHN0YXJ0VGltZUxpc3QgPSBnZXRUaW1lUmFuZ2UoYWRkTWludXRlcyhjb25mRGF5LmRhdGUsIDI0MCksIGFkZE1pbnV0ZXMoY29uZkRheS5kYXRlLCA3ODApLCBTRVNTSU9OX0xFTkdUSCk7XHJcbiAgICBmb3IgKHZhciBzdGFydFRpbWUgb2Ygc3RhcnRUaW1lTGlzdCkge1xyXG4gICAgICAgIHZhciBpc0JyZWFrID0gZmFsc2U7XHJcbiAgICAgICAgdmFyIHNlc3Npb25UaXRsZSA9ICcnO1xyXG4gICAgICAgIGlmIChzdGFydFRpbWUuZ2V0SG91cnMoKSA9PSA0KSB7XHJcbiAgICAgICAgICAgIGlzQnJlYWsgPSB0cnVlO1xyXG4gICAgICAgICAgICBzZXNzaW9uVGl0bGUgPSAnV2VsY29tZSBNZXNzYWdlJztcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoc3RhcnRUaW1lLmdldEhvdXJzKCkgPT0gOCkge1xyXG4gICAgICAgICAgICBpc0JyZWFrID0gdHJ1ZTtcclxuICAgICAgICAgICAgc2Vzc2lvblRpdGxlID0gJ0x1bmNoIEJyZWFrJztcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGNUaW1lU2xvdDogQ29uZlRpbWVTbG90ID0geyB0aXRsZTogc2Vzc2lvblRpdGxlLCBpc0JyZWFrOiBpc0JyZWFrLCBzdGFydDogc3RhcnRUaW1lLCBlbmQ6IGFkZE1pbnV0ZXMoc3RhcnRUaW1lLCBTRVNTSU9OX0xFTkdUSCkgfTtcclxuICAgICAgICB0aW1lU2xvdExpc3QucHVzaChjVGltZVNsb3QpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRpbWVTbG90TGlzdDtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0VGltZVJhbmdlKHN0YXJ0VGltZTogRGF0ZSwgZW5kVGltZTogRGF0ZSwgbWludXRlc0JldHdlZW46IG51bWJlcikgOiBBcnJheTxEYXRlPiB7XHJcbiAgICB2YXIgc3RhcnRUaW1lTGlzdDogQXJyYXk8RGF0ZT4gPSBbXTtcclxuICAgIHZhciBkaWZmSW5NaW51dGVzID0gTWF0aC5yb3VuZCgoZW5kVGltZS5nZXRUaW1lKCkgLSBzdGFydFRpbWUuZ2V0VGltZSgpKSAvIDYwMDAwKTtcclxuICAgIHZhciBwZXJpb2RzOiBudW1iZXIgPSBkaWZmSW5NaW51dGVzIC8gbWludXRlc0JldHdlZW47XHJcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8PSBwZXJpb2RzOyBpKyspIHtcclxuICAgICAgICBsZXQgcGVyaW9kU3RhcnQgPSBhZGRNaW51dGVzKHN0YXJ0VGltZSwgKG1pbnV0ZXNCZXR3ZWVuICogaSkpO1xyXG4gICAgICAgIHN0YXJ0VGltZUxpc3QucHVzaChwZXJpb2RTdGFydCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gc3RhcnRUaW1lTGlzdDtcclxufVxyXG5cclxuZnVuY3Rpb24gYWRkTWludXRlcyhkYXRlOiBEYXRlLCBtaW51dGVzOiBudW1iZXIpIHtcclxuICAgIHJldHVybiBuZXcgRGF0ZShkYXRlLmdldFRpbWUoKSArIG1pbnV0ZXMqNjAwMDApO1xyXG59XHJcblxyXG5mdW5jdGlvbiB0b1RpdGxlQ2FzZShzdHIpIHtcclxuICAgIHJldHVybiBzdHIucmVwbGFjZSgvXFx3XFxTKi9nLCBmdW5jdGlvbih0eHQpe3JldHVybiB0eHQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyB0eHQuc3Vic3RyKDEpLnRvTG93ZXJDYXNlKCk7fSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldFJhbmRvbUFycmF5RWxlbWVudHMoYXJyLCBjb3VudCkge1xyXG4gICAgdmFyIHNodWZmbGVkID0gYXJyLnNsaWNlKDApLCBpID0gYXJyLmxlbmd0aCwgbWluID0gaSAtIGNvdW50LCB0ZW1wLCBpbmRleDtcclxuICAgIHdoaWxlIChpLS0gPiBtaW4pIHtcclxuICAgICAgICBpbmRleCA9IE1hdGguZmxvb3IoKGkgKyAxKSAqIE1hdGgucmFuZG9tKCkpO1xyXG4gICAgICAgIHRlbXAgPSBzaHVmZmxlZFtpbmRleF07XHJcbiAgICAgICAgc2h1ZmZsZWRbaW5kZXhdID0gc2h1ZmZsZWRbaV07XHJcbiAgICAgICAgc2h1ZmZsZWRbaV0gPSB0ZW1wO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHNodWZmbGVkLnNsaWNlKG1pbik7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldFNwZWFrZXJBdmF0YXJzKHBhdGgpIHtcclxuICAgIHZhciBhdmF0YXJMaXN0OiBBcnJheTxzdHJpbmc+ID0gW107XHJcbiAgICB2YXIgY3VycmVudEFwcEZvbGRlciA9IGZpbGVTeXN0ZW1Nb2R1bGUua25vd25Gb2xkZXJzLmN1cnJlbnRBcHAoKTtcclxuICAgIHZhciBmaWxlID0gY3VycmVudEFwcEZvbGRlci5nZXRGaWxlKHBhdGgpO1xyXG4gICAgdmFyIGZpbGVUZXh0ID0gZmlsZS5yZWFkVGV4dFN5bmMoKTtcclxuICAgIFxyXG4gICAgdmFyIGxpbmVzID0gZmlsZVRleHQuc3BsaXQoJ1xcbicpO1xyXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaW5lcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIGF2YXRhckxpc3QucHVzaCgnZGF0YTppbWFnZS9wbmc7YmFzZTY0LCcgKyBsaW5lc1tpXSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gYXZhdGFyTGlzdDtcclxufSJdfQ==